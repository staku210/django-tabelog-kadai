{% extends "base.html" %}
{% block title %}ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±{% endblock %}

{% block main %}
<div class="container mt-5">

  <!-- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ± -->
  <div class="card shadow-sm mb-5">
    <div class="card-body">
      <h4 class="fw-bold mb-3">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±</h4>

      <p><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼š</strong>{{ user.username }}</p>
      <p><strong>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼š</strong>{{ user.email }}</p>

      <div class="d-flex gap-2 mb-3">
        <a href="{% url 'user_edit' %}" class="btn btn-outline-primary btn-sm">ç·¨é›†</a>
        <a href="{% url 'password_reset' %}" class="btn btn-outline-secondary btn-sm">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´</a>
      </div>

      {% if not user.is_premium %}
        <div class="alert alert-warning">
          ç¾åœ¨ã¯ <strong>ç„¡æ–™ä¼šå“¡</strong> ã§ã™ã€‚
        </div>

        <form action="{% url 'create-checkout-session' %}" method="POST">
          {% csrf_token %}
          <button type="submit" class="btn btn-success w-100">
            æœ‰æ–™ä¼šå“¡ã«ãªã‚‹
          </button>
        </form>
        <p>æœ‰æ–™ä¼šå“¡ã¯ãŠæ°—ã«å…¥ã‚Šç™»éŒ²ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿ã€åº—èˆ—äºˆç´„ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚</p>
      {% else %}
        <div class="alert alert-success">
          âœ… ã‚ãªãŸã¯ <strong>æœ‰æ–™ä¼šå“¡</strong> ã§ã™ï¼
        </div>

        <form action="{% url 'cancel_subscription' %}" method="post">
          {% csrf_token %}
          <button class="btn btn-danger w-100" type="submit">
            æœ‰æ–™ä¼šå“¡ã‚’é€€ä¼šã™ã‚‹
          </button>
        </form>
      {% endif %}
    </div>
  </div>

  <!-- äºˆç´„å±¥æ­´ -->
  <div class="mb-5">
    <h4 class="fw-bold mb-3">äºˆç´„å±¥æ­´ä¸€è¦§</h4>

    {% for reservation in reservations %}
      <div class="card mb-3 shadow-sm">
        <div class="card-body">
          <p><strong>åº—èˆ—åï¼š</strong>{{ reservation.restaurant.name }}</p>
          <p>ğŸ“… {{ reservation.date }} / â° {{ reservation.time }}</p>
          <p>ğŸ‘¤ {{ reservation.number_of_people }} äºº</p>

          <a href="{% url 'reservation_delete' reservation.pk %}"
             class="btn btn-outline-danger btn-sm">
            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
          </a>
        </div>
      </div>
    {% empty %}
      <p class="text-muted">äºˆç´„å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    {% endfor %}
  </div>

  <!-- ãŠæ°—ã«å…¥ã‚Š -->
  <div class="mb-5">
    <h4 class="fw-bold mb-3">ãŠæ°—ã«å…¥ã‚Šç™»éŒ²ã—ãŸåº—èˆ—</h4>

    <div class="row">
      {% for favorite in favorites %}
        <div class="col-md-4 mb-4">
          <div class="card h-100 shadow-sm">

            <img src="{{ favorite.restaurant.img.url }}"
                 class="card-img-top"
                 style="height:200px; object-fit:cover;">

            <div class="card-body">
              <h5 class="fw-bold">{{ favorite.restaurant.name }}</h5>
              <p>ğŸ’° {{ favorite.restaurant.price }}</p>
              <p>ğŸ“ {{ favorite.restaurant.address }}</p>
              <p>ğŸ· {{ favorite.restaurant.category }}</p>
            </div>

          </div>
        </div>
      {% empty %}
        <p class="text-muted">ãŠæ°—ã«å…¥ã‚Šåº—èˆ—ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
      {% endfor %}
    </div>
  </div>

  <!-- æˆ»ã‚‹ -->
  <div class="text-center mb-5">
    <a href="{% url 'list' %}" class="btn btn-outline-dark">
      â† åº—èˆ—ä¸€è¦§ã«æˆ»ã‚‹
    </a>
  </div>

</div>
{% endblock %}
