{% extends "base.html" %}
{% block title %}店舗一覧{% endblock %}

{% block main %}
<div class="container mt-4">

  <h2 class="mb-4 fw-bold">店舗一覧</h2>

  <div class="row">
    {% for restaurant in object_list %}
    <div class="col-md-4 mb-4">
      <div class="card shadow-sm h-100">

        <!-- 画像 -->
        {% if restaurant.img and restaurant.img.url %}
         <img src="{{ restaurant.img.url }}" class="card-img-top" style="height:220px; object-fit:cover;">
        {% else %}
         <img src="{% static 'noImage.png' %}" class="card-img-top" style="height:220px; object-fit:cover;">
        {% endif %}

        <div class="card-body d-flex flex-column">

          <!-- 店名 -->
          <h5 class="card-title fw-bold">{{ restaurant.name }}</h5>

          <!-- 価格 -->
          <p class="text-muted mb-2">予算：¥{{ restaurant.price }}</p>

          <!-- ボタン -->
          <div class="mt-auto d-flex justify-content-between">

            <button class="btn btn-outline-primary btn-sm"
              onclick="location.href='{% url 'detail' pk=restaurant.pk %}'">
              詳細
            </button>

            <button class="btn btn-outline-success btn-sm"
              onclick="location.href='{% url 'reservation' restaurant_id=restaurant.pk %}'">
              予約
            </button>
          </div>

          <!-- お気に入り -->
          {% if user.is_authenticated %}
          <form action="{% url 'favorite' restaurant.id %}" method="post" class="mt-2">
            {% csrf_token %}
            <button class="btn btn-warning btn-sm w-100" type="submit">
              {% if restaurant.is_favorited %}
                ★ お気に入り解除
              {% else %}
                ☆ お気に入り登録
              {% endif %}
            </button>
          </form>
          {% endif %}

        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- カテゴリー一覧 -->
  <div class="mt-5">
    <h4 class="fw-bold mb-3">カテゴリー</h4>
    <div class="d-flex flex-wrap gap-2">
      {% for category in categories %}
        <a href="{% url 'category' category.id %}"
           class="btn btn-outline-secondary btn-sm">
          {{ category.name }}
        </a>
      {% endfor %}
    </div>
  </div>

</div>
{% endblock %}
